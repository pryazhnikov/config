#!/bin/sh

GIT_BRANCH=`git name-rev --name-only HEAD`
JIRA_CODE=`echo $GIT_BRANCH | sed -e 's/_[a-z0-9_]*//'`

echo Branch: $GIT_BRANCH
if [ "$GIT_BRANCH" == "$JIRA_CODE" ]
then
    >&2 echo "Error:  cannot detect jira issue code!"
    exit
fi

if [[ "" == "${JIRA_URL_PREFIX}" ]]; then
    >&2 echo "Please define JIRA_URL_PREFIX env var"
    exit
fi

echo "Issue:  ${JIRA_URL_PREFIX}${JIRA_CODE}"
echo
